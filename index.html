<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <script src="https://unpkg.com/@heygen/streaming-avatar@latest/dist/index.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; display: flex; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif; }
        #canvas { width: 100%; height: 100%; }
        button { 
            position: absolute; z-index: 100; padding: 15px 30px; font-size: 18px; 
            cursor: pointer; border-radius: 50px; border: none; 
            background: #3f8b8c; color: white; font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <button id="btn">Iniciar Consultoria de Design</button>
    <div id="canvas"></div>

    <script>
        const btn = document.getElementById('btn');
        let avatar = null;

        async function start() {
            btn.innerText = "A ligar ao tutor...";
            btn.disabled = true;

            const API_KEY = '0cadfbf8-eedc-11f0-a99e-066a7fa2e369';
            const AVATAR_ID = '073b60a9-89a8-45aa-8902-c358f64d2852';

            try {
                // Criar a instância do Avatar
                avatar = new HeyGenStreamingAvatar.default({ token: API_KEY });
                
                // Iniciar o avatar usando as definições que já tens na HeyGen
                await avatar.createStartAvatar({
                    avatarName: AVATAR_ID,
                    quality: "medium",
                    knowledgeId: AVATAR_ID // Usa o ID do avatar também como ID de conhecimento
                });

                // Definir onde o vídeo aparece
                avatar.on('stream_ready', (event) => {
                    const videoEl = document.createElement('video');
                    videoEl.srcObject = event.detail;
                    videoEl.autoplay = true;
                    videoEl.setAttribute('playsinline', '');
                    videoEl.style.width = '100%';
                    videoEl.style.height = '100%';
                    videoEl.style.objectFit = 'cover';
                    document.getElementById('canvas').appendChild(videoEl);
                    btn.style.display = 'none';
                });

            } catch (err) {
                console.error("Erro detalhado:", err);
                btn.innerText = "Erro ao ligar. Tenta de novo.";
                btn.disabled = false;
            }
        }

        btn.onclick = start;
    </script>
</body>
</html>
